#include <windows.h>
#include "Game.h"
#include "Engine.h"
#include "TitleScene.h"
#include "Scene.h"
#include "GameScene.h"

// =======================================================================================
//      コンストラクタ
// =======================================================================================
Game::Game()
{
    RegisterScenes();                       // 使用するシーンを登録

    // 初期状態から流体シミュレーションを確認できるよう、
    // 起動直後にゲームシーン（流体用シーン）へ遷移させる。
    m_SceneManager.ChangeScene("Game");
}

// =======================================================================================
//      メイン処理
// =======================================================================================
void Game::Update(float deltaTime)
{
    m_SceneManager.Update(deltaTime);
}

// =======================================================================================
//      描画処理
// =======================================================================================
void Game::Render()
{
    m_SceneManager.Render();
}

// =======================================================================================
//      シーンの登録呼び出し
// =======================================================================================
void Game::RegisterScenes()
{
    
    // 旧来のモデル表示シーン。必要に応じて切り替えられるよう登録だけ残しておく。
    m_SceneManager.RegisterScene("Scene", [this]() {
        return std::make_unique<Scene>(this);
    });

    // タイトルシーン。スペースキー入力でゲームシーンへ遷移する。
    m_SceneManager.RegisterScene("TitleScene", [this]() {
        return std::make_unique<TitleScene>(this);
    });

    // 流体シミュレーションを行うメインシーン。
    m_SceneManager.RegisterScene("Game", [this]() {
        return std::make_unique<GameScene>(this);
    });
}

// =======================================================================================
//      シーンの変更呼び出し
// =======================================================================================
void Game::ChangeScene(const std::string& name)
{
    m_SceneManager.ChangeScene(name);
}